<div class="event-details-root" [class.dark-mode]="isDarkModeActive">
  <!-- Header Reutilizável -->
  <app-header
    [isDarkMode]="isDarkModeActive"
    [showDarkModeToggle]="true"
    [showCreateEventButton]="false"
  ></app-header>

  <main class="content-wrap">
    <!-- Botão Voltar -->
    <div class="back-button-container">
      <button (click)="goBack()" class="back-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path
            d="M19 12H5M12 19L5 12L12 5"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
        Voltar
      </button>
    </div>

    <!-- Loading state -->
    @if (!showContent && !error) {
    <div class="loading-container" [attr.data-key]="renderKey">
      <div class="loading-spinner"></div>
      <p>Carregando evento...</p>
    </div>
    }

    <!-- Error state -->
    @if (error) {
    <div class="error-container" [attr.data-key]="renderKey">
      <p>{{ error }}</p>
      <button (click)="ngOnInit()" class="retry-btn">Tentar Novamente</button>
    </div>
    }

    <!-- Event content - only show when showContent is true -->
    @if (showContent && event) {
    <div class="event-content-wrapper" [attr.data-key]="renderKey">
      <!-- Hero Section do Evento -->
      <section class="event-hero">
        <div class="hero-container">
          <div class="hero-content">
            <div class="event-meta">
              <span class="event-tag text-badge">{{ event.eventType }}</span>
            </div>

            <h1 class="event-title">{{ event.name }}</h1>

            <div class="event-quick-info">
              <div class="info-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                  <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2" />
                </svg>
                <span>{{ event.eventDate }}</span>
              </div>

              <div class="info-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" />
                </svg>
                <span>{{ eventlocation?.placeName }}</span>
              </div>

              <div class="info-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <circle cx="8.5" cy="7" r="4" stroke="currentColor" stroke-width="2" />
                  <path d="M20 8v6M23 11l-3 3-3-3" stroke="currentColor" stroke-width="2" />
                </svg>
                <span>{{ event.subscribedCount }}/{{ event.maxSubs }} inscritos</span>
              </div>
            </div>
          </div>

          <div class="hero-image">
            <img [src]="event.imageUrl" [alt]="event.name" (error)="onImageError($event)" />
            <div class="image-overlay"></div>
          </div>
        </div>
      </section>

      <!-- Seção Principal com Informações -->
      <section class="event-info">
        <div class="info-container">
          <div class="info-grid">
            <!-- Coluna Principal - Descrição -->
            <div class="main-info">
              <div class="info-card">
                <h2>Sobre o Evento</h2>
                <p class="event-description">{{ event.description }}</p>

                <!-- Informações do local -->
                <div class="location-details" *ngIf="event.location">
                  <h3>Localização</h3>
                  <div class="location-info">
                    <p><strong>Endereço:</strong> {{ event.location.fullAddress }}</p>
                    <p><strong>CEP:</strong> {{ event.location.zipCode }}</p>
                    <p><strong>Categoria:</strong> {{ event.location.category }}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Coluna Lateral - Ações -->
            <div class="sidebar-info">
              <div class="registration-card">
                <div class="price-section">
                  <span class="price-label">Ingresso</span>
                  <span class="price-value">Gratuito</span>
                </div>

                <div class="availability">
                  <div class="availability-bar">
                    <div
                      class="availability-fill"
                      [style.width.%]="(event.subscribedCount / event.maxSubs) * 100"
                    ></div>
                  </div>
                  <span class="availability-text">
                    {{ event.maxSubs - event.subscribedCount }} vagas restantes
                  </span>
                </div>

                <button (click)="handleRegisterClick()" [ngClass]="{'register-btn': true, 'primary': !isUserSubscribed, 'danger': isUserSubscribed}">
                  @if (isUserSubscribed) {
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                    Desinscrever-se do Evento
                  } @else {
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" />
                    </svg>
                    Inscrever-se no Evento
                  }
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
    }
  </main>

  <!-- Modal de Login -->
  @if (showLoginModal) {
  <div class="modal-overlay" (click)="closeLoginModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" class="modal-icon">
          <circle cx="12" cy="12" r="10" stroke="#6366f1" stroke-width="2" />
          <path d="M12 8v4M12 16h.01" stroke="#6366f1" stroke-width="2" stroke-linecap="round" />
        </svg>
        <h2>Login Necessário</h2>
        <p>Para se inscrever neste evento, você precisa estar logado em sua conta.</p>
      </div>

      <div class="modal-actions">
        <button (click)="goToLogin()" class="modal-btn primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path
              d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <polyline points="10 17 15 12 10 7" stroke="currentColor" stroke-width="2" />
            <line x1="15" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" />
          </svg>
          Fazer Login
        </button>

        <button (click)="goToRegister()" class="modal-btn secondary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path
              d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"
              stroke="currentColor"
              stroke-width="2"
            />
            <circle cx="8.5" cy="7" r="4" stroke="currentColor" stroke-width="2" />
            <line x1="20" y1="8" x2="20" y2="14" stroke="currentColor" stroke-width="2" />
            <line x1="23" y1="11" x2="17" y2="11" stroke="currentColor" stroke-width="2" />
          </svg>
          Não tem uma conta? Cadastre-se
        </button>

        <button (click)="closeLoginModal()" class="modal-btn cancel">Cancelar</button>
      </div>
    </div>
  </div>
  }

  <!-- Modal de Confirmação de Inscrição -->
  <app-event-registration-modal
    [isOpen]="showRegistrationModal"
    [eventId]="event?.id || 0"
    [eventName]="event?.name || ''"
    [isUserSubscribed]="isUserSubscribed"
    (close)="closeRegistrationModal()"
    (registerSuccess)="handleRegistrationSuccess()"
    (unregisterSuccess)="handleUnregistrationSuccess()"
  >
  </app-event-registration-modal>
</div>
